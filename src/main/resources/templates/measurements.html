<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>From Hero To Zero - Measurements</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB"
          crossorigin="anonymous">
</head>
<body class="bg-light">

<nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm">
    <div class="container">
        <a class="navbar-brand fw-bold" href="/" th:href="@{/}">From Hero To Zero</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto">
                <li class="nav-item"><a class="nav-link" href="/" th:href="@{/}">Home</a></li>
                <li class="nav-item"><a class="nav-link" href="/workspace" th:href="@{/workspace}">Workspace</a></li>
                <li class="nav-item"><a class="nav-link active" href="/measurements" th:href="@{/measurements}">Measurements</a></li>
            </ul>
        </div>
    </div>
</nav>

<div class="container my-5">

    <div class="text-center mb-5">
        <h1 class="fw-bold">Measurements</h1>
        <p class="text-muted">View and add CO2 emission data per country</p>
    </div>

    <div class="mb-3">
        <label for="countryFilter" class="form-label fw-semibold">Filter by Country</label>
        <select class="form-select" id="countryFilter">
            <option value="">All Countries</option>
            <option th:each="m : ${measurements}"
                    th:value="${m.country?.name}"
                    th:text="${m.country?.name}">
            </option>
        </select>
    </div>

    <div class="card shadow-sm mb-5">
        <div class="card-body">
            <table id="measurements" class="table table-bordered table-striped mb-0">
                <thead class="table-dark">
                <tr>
                    <th>Country</th>
                    <th>Year</th>
                    <th>CO2 Emissions (million tons)</th>
                    <th>Status of Data Set</th>
                    <th>Action</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="measurement : ${measurements}">
                    <td th:text="${measurement.country?.name}">No Country</td>
                    <td th:text="${measurement.year}"></td>
                    <td th:text="${measurement.value}"></td>
                    <td th:text="${measurement.status.status}"></td>
                    <td>
                        <a th:if="${measurement.status.status == 'Proposed'}"
                           th:href="@{/measurements/edit/{id}(id=${measurement.id})}"
                           class="btn btn-sm btn-warning">
                            Update
                        </a>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div class="card shadow-sm">
        <div class="card-body">
            <h4 class="card-title mb-4">Add New Measurement</h4>
            <form role="form" th:action="@{/measurements/add}" th:object="${measurement}" method="post">

                <div class="mb-3">
                    <label for="country" class="form-label">Country</label>
                    <select class="form-select" id="country" th:field="*{countryId}" required>
                        <option th:each="c : ${countries}" th:value="${c.id}" th:text="${c.name}"></option>
                    </select>
                </div>

                <div class="mb-3">
                    <label for="year" class="form-label">Year</label>
                    <input type="number" class="form-control" id="year" th:field="*{year}" placeholder="Year" required>
                </div>

                <div class="mb-3">
                    <label for="value" class="form-label">CO2 Emissions (million tons)</label>
                    <input type="number" step="0.01" class="form-control" id="value" th:field="*{value}" placeholder="Value" required>
                </div>

                <button type="submit" class="btn btn-primary">Add Measurement</button>
            </form>
        </div>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
        crossorigin="anonymous"></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const countryFilter = document.getElementById('countryFilter');
        const tableBody = document.querySelector('#measurements tbody');

        const seen = new Set();
        Array.from(countryFilter.options).forEach(option => {
            if (option.value !== "" && seen.has(option.value)) {
                option.remove();
            } else {
                seen.add(option.value);
            }
        });

        countryFilter.addEventListener('change', function () {
            const filterValue = this.value.toLowerCase();
            Array.from(tableBody.rows).forEach(row => {
                const countryName = row.cells[0].textContent.toLowerCase();
                row.style.display = filterValue === '' || countryName === filterValue ? '' : 'none';
            });
        });
    });
</script>
</body>
</html>
